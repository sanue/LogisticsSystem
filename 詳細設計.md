# **物流管理システム 简化版 詳細設計書**

**版数:** 2.0
**作成日:** 2025年1月
**作成者:** [社名]
**確認者:** [クライアント先担当者名]

---

## 1. 概要

本詳細設計書は、要件定義書（简化版）を基に、1名の開発者で1ヶ月以内に開発可能な物流管理システムの具体的な設計内容を定義する。

**設計対象:**
* 入荷・検品管理（基本機能）
* 在庫管理（棚卸含む）
* 出荷管理（基本機能）
* マスタデータ管理
* 基本レポート機能

---

## 2. アーキテクチャ設計

### 2.1. システム構成

```
[ブラウザ] <--HTTP--> [Spring Boot Web App] <--JDBC--> [Oracle DB]
                            |--> [PL/SQL Stored Procedures]
                            |--> [MyBatis Mapper]
```

**技術スタック:**
* **フロントエンド:** HTML + CSS + JavaScript + Bootstrap
* **バックエンド:** Spring Boot 3.x (Java 17)
* **データベース:** Oracle Database 19c
* **ORM:** MyBatis
* **業務ロジック:** PL/SQLストアドプロシージャ

### 2.2. パッケージ構成

```
com.logistics.simplified
├── controller/          # コントローラー層
├── service/            # サービス層
├── mapper/             # MyBatisマッパー
├── entity/             # エンティティ
├── dto/                # データ転送オブジェクト
└── config/             # 設定クラス
```

---

## 3. 画面設計

### 3.1. 共通レイアウト

**ヘッダー:**
- システム名: "物流管理システム（简化版）"
- ナビゲーションメニュー
- ユーザー情報表示

**サイドバー:**
- 入荷管理
- 在庫管理
- 出荷管理
- マスタ管理
- レポート

### 3.2. 入荷管理画面

#### 3.2.1. 入荷予定登録画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| ASN番号 | テキスト | × | 仕入先ASN番号 |
| 商品コード | セレクト | ○ | 商品マスタから選択 |
| 予定数量 | 数値 | ○ | 入荷予定数量 |
| 入荷予定日 | 日付 | ○ | 入荷予定日 |

**ボタン:**
- 登録ボタン
- 一覧表示ボタン

#### 3.2.2. 入荷実績入力画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 入荷予定選択 | セレクト | ○ | 未入荷の予定から選択 |
| 実績数量 | 数値 | ○ | 実際の入荷数量 |
| 差異理由 | テキスト | × | 差異がある場合の理由 |

**ボタン:**
- 入荷完了ボタン
- キャンセルボタン

### 3.3. 在庫管理画面

#### 3.3.1. 在庫一覧画面
| 項目 | 型 | 備考 |
|:--- |:--- |:--- |
| 商品コード | テキスト | 商品マスタ参照 |
| 商品名 | テキスト | 商品マスタ参照 |
| ロケーション | テキスト | ロケーションマスタ参照 |
| 現在庫数 | 数値 | 在庫テーブル |
| 安全在庫 | 数値 | 商品マスタ参照 |
| 最終更新日時 | 日時 | 在庫テーブル |

**フィルター:**
- 商品コード検索
- ロケーション検索
- 安全在庫以下表示

#### 3.3.2. 棚卸実施画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 商品コード | セレクト | ○ | 商品マスタから選択 |
| ロケーション | セレクト | ○ | ロケーションマスタから選択 |
| システム在庫 | 数値 | - | 自動表示（読み取り専用） |
| 実地棚卸数量 | 数値 | ○ | 実際に数えた数量 |
| 差異数量 | 数値 | - | 自動計算（読み取り専用） |

**ボタン:**
- 棚卸完了ボタン
- キャンセルボタン

### 3.4. 出荷管理画面

#### 3.4.1. 出荷指示登録画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 注文番号 | テキスト | ○ | 受注番号 |
| 顧客 | セレクト | ○ | 顧客マスタから選択 |
| 商品 | セレクト | ○ | 商品マスタから選択 |
| 注文数量 | 数値 | ○ | 出荷予定数量 |
| 出荷予定日 | 日付 | ○ | 出荷予定日 |

**ボタン:**
- 登録ボタン
- 一覧表示ボタン

#### 3.4.2. 出荷実績登録画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 出荷指示選択 | セレクト | ○ | 未出荷の指示から選択 |
| 出荷数量 | 数値 | ○ | 実際の出荷数量 |
| 運送会社 | テキスト | ○ | 運送会社名 |
| 伝票番号 | テキスト | ○ | 運送伝票番号 |

**ボタン:**
- 出荷完了ボタン
- キャンセルボタン

### 3.5. マスタ管理画面

#### 3.5.1. 商品マスタ管理画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 商品コード | テキスト | ○ | 主キー |
| 商品名 | テキスト | ○ | 商品名称 |
| 規格 | テキスト | × | 商品規格 |
| 単位 | テキスト | ○ | 数量単位 |
| 安全在庫 | 数値 | ○ | 安全在庫数量 |

**ボタン:**
- 新規登録ボタン
- 更新ボタン
- 削除ボタン
- 検索ボタン

#### 3.5.2. 顧客マスタ管理画面
| 項目 | 型 | 必須 | 備考 |
|:--- |:--- |:--- |:--- |
| 顧客コード | テキスト | ○ | 主キー |
| 顧客名 | テキスト | ○ | 顧客名称 |
| 住所 | テキスト | × | 顧客住所 |
| 電話番号 | テキスト | × | 連絡先電話番号 |

**ボタン:**
- 新規登録ボタン
- 更新ボタン
- 削除ボタン
- 検索ボタン

### 3.6. レポート画面

#### 3.6.1. 日次入出庫レポート画面
| 項目 | 型 | 備考 |
|:--- |:--- |:--- |
| レポート日付 | 日付 | レポート対象日 |
| 入荷実績 | テーブル | 商品別入荷数量 |
| 出荷実績 | テーブル | 商品別出荷数量 |
| サマリー | テーブル | 入出庫合計 |

**ボタン:**
- レポート生成ボタン
- 印刷ボタン
- エクスポートボタン

---

## 4. データベース設計

### 4.1. テーブル一覧

| テーブル名 | 説明 | 主キー |
|:--- |:--- |:--- |
| PRODUCT_MASTER | 商品マスタ | PRODUCT_ID |
| CUSTOMER_MASTER | 顧客マスタ | CUSTOMER_ID |
| LOCATION_MASTER | ロケーションマスタ | LOCATION_ID |
| INCOMING_RECORD | 入荷記録 | RECORD_ID |
| INVENTORY | 在庫 | INVENTORY_ID |
| SHIPMENT_RECORD | 出荷記録 | RECORD_ID |
| STOCKTAKE_RECORD | 棚卸記録 | STOCKTAKE_ID |
| OPERATION_LOG | 操作ログ | LOG_ID |

### 4.2. 主要テーブル詳細

#### 4.2.1. 商品マスタ（PRODUCT_MASTER）

| カラム名 | データ型 | 制約 | 説明 |
|:--- |:--- |:--- |:--- |
| PRODUCT_ID | VARCHAR2(20) | PK, NOT NULL | 商品コード |
| PRODUCT_NAME | VARCHAR2(100) | NOT NULL | 商品名 |
| SPECIFICATION | VARCHAR2(200) | | 規格 |
| UNIT | VARCHAR2(10) | NOT NULL | 単位 |
| SAFETY_STOCK | NUMBER | DEFAULT 0 | 安全在庫 |
| CREATED_AT | DATE | DEFAULT SYSDATE | 作成日時 |
| UPDATED_AT | DATE | DEFAULT SYSDATE | 更新日時 |

#### 4.2.2. 入荷記録（INCOMING_RECORD）

| カラム名 | データ型 | 制約 | 説明 |
|:--- |:--- |:--- |:--- |
| RECORD_ID | NUMBER | PK, NOT NULL | 記録ID |
| ASN_NO | VARCHAR2(20) | | ASN番号 |
| PRODUCT_ID | VARCHAR2(20) | FK, NOT NULL | 商品コード |
| PLAN_QTY | NUMBER | | 予定数量 |
| ACTUAL_QTY | NUMBER | | 実績数量 |
| ARRIVAL_DATE | DATE | | 入荷予定日 |
| STATUS | VARCHAR2(10) | DEFAULT 'PLANNED' | ステータス |
| DISCREPANCY_REASON | VARCHAR2(200) | | 差異理由 |
| RECEIVED_AT | TIMESTAMP | | 入荷日時 |
| CREATED_AT | DATE | DEFAULT SYSDATE | 作成日時 |

#### 4.2.3. 在庫（INVENTORY）

| カラム名 | データ型 | 制約 | 説明 |
|:--- |:--- |:--- |:--- |
| INVENTORY_ID | NUMBER | PK, NOT NULL | 在庫ID |
| PRODUCT_ID | VARCHAR2(20) | FK, NOT NULL | 商品コード |
| LOCATION_ID | VARCHAR2(20) | FK, NOT NULL | ロケーションID |
| QUANTITY | NUMBER | DEFAULT 0 | 数量 |
| LAST_UPDATED | TIMESTAMP | DEFAULT SYSTIMESTAMP | 最終更新日時 |

### 4.3. インデックス設計

| テーブル名 | インデックス名 | カラム | 用途 |
|:--- |:--- |:--- |:--- |
| INCOMING_RECORD | IDX_INCOMING_PRODUCT | PRODUCT_ID | 商品別検索 |
| INCOMING_RECORD | IDX_INCOMING_DATE | ARRIVAL_DATE | 日付別検索 |
| INVENTORY | IDX_INVENTORY_PRODUCT | PRODUCT_ID | 商品別在庫検索 |
| INVENTORY | IDX_INVENTORY_LOCATION | LOCATION_ID | ロケーション別検索 |
| SHIPMENT_RECORD | IDX_SHIPMENT_CUSTOMER | CUSTOMER_ID | 顧客別検索 |

---

## 5. PL/SQLストアドプロシージャ設計

### 5.1. 入荷処理（SP_PROCESS_INCOMING）

**目的:** 入荷実績を登録し、在庫を更新する

**パラメータ:**
- p_asn_no VARCHAR2 - ASN番号
- p_product_id VARCHAR2 - 商品コード
- p_plan_qty NUMBER - 予定数量
- p_actual_qty NUMBER - 実績数量
- p_arrival_date DATE - 入荷予定日
- p_discrepancy_reason VARCHAR2 - 差異理由

**処理内容:**
1. 入荷記録テーブルに実績を登録
2. 在庫テーブルの数量を更新
3. 操作ログを記録

### 5.2. 出荷処理（SP_PROCESS_SHIPMENT）

**目的:** 出荷実績を登録し、在庫を減算する

**パラメータ:**
- p_order_no VARCHAR2 - 注文番号
- p_customer_id VARCHAR2 - 顧客コード
- p_product_id VARCHAR2 - 商品コード
- p_order_qty NUMBER - 注文数量
- p_carrier VARCHAR2 - 運送会社
- p_tracking_no VARCHAR2 - 伝票番号

**処理内容:**
1. 在庫数量のチェック
2. 出荷記録テーブルに実績を登録
3. 在庫テーブルの数量を減算
4. 操作ログを記録

### 5.3. 棚卸処理（SP_PROCESS_STOCKTAKE）

**目的:** 棚卸実績を登録し、在庫を調整する

**パラメータ:**
- p_product_id VARCHAR2 - 商品コード
- p_location_id VARCHAR2 - ロケーションID
- p_counted_qty NUMBER - 実地棚卸数量

**処理内容:**
1. システム在庫数量を取得
2. 差異数量を計算
3. 棚卸記録テーブルに実績を登録
4. 在庫テーブルの数量を調整
5. 操作ログを記録

### 5.4. 在庫アラート（SP_CHECK_INVENTORY_ALERT）

**目的:** 安全在庫以下の商品をチェックする

**処理内容:**
1. 在庫数量が安全在庫以下の商品を検索
2. アラート情報を出力
3. 必要に応じて通知処理を実行

### 5.5. 日次レポート生成（SP_GENERATE_DAILY_REPORT）

**目的:** 日次入出庫レポートを生成する

**パラメータ:**
- p_report_date DATE - レポート対象日

**処理内容:**
1. 指定日の入荷実績を集計
2. 指定日の出荷実績を集計
3. レポートデータを出力

---

## 6. アプリケーション設計

### 6.1. コントローラー設計

#### 6.1.1. IncomingController
```java
@RestController
@RequestMapping("/api/incoming")
public class IncomingController {
    
    @PostMapping("/plan")
    public ResponseEntity<String> createPlan(@RequestBody IncomingPlanDto dto);
    
    @PostMapping("/actual")
    public ResponseEntity<String> processActual(@RequestBody IncomingActualDto dto);
    
    @GetMapping("/list")
    public ResponseEntity<List<IncomingRecord>> getList();
}
```

#### 6.1.2. InventoryController
```java
@RestController
@RequestMapping("/api/inventory")
public class InventoryController {
    
    @GetMapping("/list")
    public ResponseEntity<List<Inventory>> getList();
    
    @PostMapping("/stocktake")
    public ResponseEntity<String> processStocktake(@RequestBody StocktakeDto dto);
    
    @GetMapping("/alert")
    public ResponseEntity<List<InventoryAlert>> getAlert();
}
```

### 6.2. サービス設計

#### 6.2.1. IncomingService
```java
@Service
public class IncomingService {
    
    @Autowired
    private IncomingMapper incomingMapper;
    
    public void createPlan(IncomingPlanDto dto) {
        // 入荷予定登録処理
    }
    
    public void processActual(IncomingActualDto dto) {
        // 入荷実績処理（PL/SQL呼び出し）
        incomingMapper.processIncoming(dto);
    }
}
```

### 6.3. MyBatisマッパー設計

#### 6.3.1. IncomingMapper
```java
@Mapper
public interface IncomingMapper {
    
    @Select("SELECT * FROM INCOMING_RECORD WHERE PRODUCT_ID = #{productId}")
    List<IncomingRecord> findByProductId(String productId);
    
    @Select("CALL SP_PROCESS_INCOMING(#{asnNo}, #{productId}, #{planQty}, #{actualQty}, #{arrivalDate}, #{discrepancyReason})")
    void processIncoming(IncomingActualDto dto);
}
```

---

## 7. セキュリティ設計

### 7.1. 認証・認可
- 基本的なユーザー認証（ユーザー名・パスワード）
- セッション管理
- 操作ログの記録

### 7.2. データ保護
- SQLインジェクション対策（PreparedStatement使用）
- XSS対策（入力値のサニタイズ）
- CSRF対策（トークン検証）

---

## 8. テスト設計

### 8.1. 単体テスト
- 各コントローラーのテスト
- 各サービスのテスト
- PL/SQLストアドプロシージャのテスト

### 8.2. 結合テスト
- 画面操作からデータベース更新までの一連の流れ
- エラー処理の確認

### 8.3. テストデータ
- 商品マスタテストデータ（10件）
- 顧客マスタテストデータ（5件）
- ロケーションマスタテストデータ（20件）

---

## 9. デプロイ設計

### 9.1. 開発環境
- Oracle Database 19c XE
- Java 17
- Spring Boot 3.x
- Maven

### 9.2. 本番環境
- Oracle Database 19c
- Linuxサーバー
- Tomcat（Spring Boot内蔵）
- リバースプロキシ（Nginx）

---

## 10. 運用設計

### 10.1. バックアップ
- データベースの日次バックアップ
- アプリケーションファイルのバックアップ

### 10.2. 監視
- アプリケーションログの監視
- データベース接続の監視
- ディスク使用量の監視

### 10.3. メンテナンス
- 定期的なログファイルの削除
- データベースの最適化
- アプリケーションの更新

---

この詳細設計書は、1名の開発者で1ヶ月以内に開発可能な簡素化版物流管理システムの具体的な設計内容を定義しています。
